<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mazmorra 3D con Monedas</title>
<style>
  body { margin: 0; overflow: hidden; }
  #coinCounter {
      position: absolute;
      top: 10px;
      left: 10px;
      color: #fff;
      font-size: 24px;
      font-family: sans-serif;
      z-index: 100;
  }
</style>

<script type="importmap">
{
  "imports": {
    "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
    "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
  }
}
</script>
</head>
<body>

<div id="coinCounter">Monedas: 0</div>

<script type="module">
import { initMundo3D, animateMundo3D, getSceneCameraRenderer } from './mundo3D.js';
import { CharacterController } from './characterController.js';
import { CoinManager } from './coins.js';

// --- Inicializar el mundo 3D
initMundo3D();
const { scene, camera, renderer, floorBox, wallBoxes } = getSceneCameraRenderer();

// --- Inicializar jugador
const playerController = new CharacterController(scene, camera, floorBox, wallBoxes);

// --- Inicializar monedas
// Esperamos un poco hasta que el player se haya cargado
const waitForPlayer = setInterval(() => {
    if (playerController.player) {
        const coinManager = new CoinManager(scene, playerController.player, 15);
        clearInterval(waitForPlayer);

        // --- Loop de animaciÃ³n principal
        function animate() {
            requestAnimationFrame(animate);
            playerController.update();
            coinManager.update();
            animateMundo3D();
        }
        animate();
    }
}, 100);

// --- Resize
window.addEventListener('resize', () => {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
});
</script>

</body>
</html>
